(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{2141:(e,a,s)=>{"use strict";s.d(a,{default:()=>u});var r=s(5155),t=s(5695),l=s(2115),i=s(2177),o=s(6421),n=s(6874),d=s.n(n);s(2913);var c=s(4540);let u=()=>{let e=(0,t.useRouter)(),a=(0,c.d4)(o.BN),s=(0,c.wA)(),[n,u]=(0,l.useState)(null),{register:m,handleSubmit:h,formState:{errors:p,isValid:g}}=(0,i.mN)({defaultValues:{email:"",password:""},mode:"onChange"}),w=async a=>{try{let r={email:a.email.trim(),password:a.password.trim()};if("admin@admin.com"===a.email&&"admin"===a.password)return void e.push("/admin");let t=(await s((0,o.tw)(r))).payload;if(!t)throw Error("No payload received");t.token?(localStorage.setItem("token",t.token),e.push("admin"===t.role?"/admin":"/")):u("Неверные учетные данные")}catch(e){u(e.message||"Ошибка сервера"),console.error("Auth error:",e)}};return a?(e.push("/"),null):(0,r.jsx)("section",{className:"Login",children:(0,r.jsxs)("div",{className:"preview",children:[(0,r.jsx)("h3",{className:"text-center",children:"Вход"}),n&&(0,r.jsx)("div",{className:"error-message",children:n}),(0,r.jsx)("div",{className:"registration-cssave",children:(0,r.jsxs)("form",{onSubmit:h(w),children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{className:"form-control-item",type:"email",placeholder:"Email",...m("email",{required:"Введите почту",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Введите корректный email"}})}),p.email&&(0,r.jsx)("p",{className:"check",children:p.email.message})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("input",{className:"form-control-item",type:"password",placeholder:"Пароль",...m("password",{required:"Введите пароль",minLength:{value:6,message:"Минимум 6 символов"}})}),p.password&&(0,r.jsx)("p",{className:"check",children:p.password.message})]}),(0,r.jsx)("div",{className:"form-group",children:(0,r.jsx)("button",{className:"btn btn-primary btn-block create-account",type:"submit",disabled:!g,children:"ВОЙТИ"})}),(0,r.jsx)("div",{className:"form-group",children:(0,r.jsxs)(d(),{href:"/register",className:"register-link",children:["Нет аккаунта? ",(0,r.jsx)("span",{children:"Зарегистрироваться"})]})})]})})]})})}},2913:()=>{},5695:(e,a,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(a,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(a,{useRouter:function(){return r.useRouter}})},6421:(e,a,s)=>{"use strict";s.d(a,{li:()=>h,tw:()=>l,Rd:()=>o,_D:()=>i,ri:()=>u,ZB:()=>c,BN:()=>d});var r=s(1990);let t=s(3464).A.create({baseURL:"http://localhost:3002"});t.interceptors.request.use(e=>(e.headers.Authorization=window.localStorage.getItem("token"),e));let l=(0,r.zD)("auth/fetchAuth",async(e,a)=>{let{rejectWithValue:s}=a;try{let a=await fetch("http://localhost:3002/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})});if(!a.ok){let e=await a.json();return s(e)}return await a.json()}catch(e){return s(e.message)}}),i=(0,r.zD)("auth/fetchRegister",async(e,a)=>{let{rejectWithValue:s}=a;try{let{data:a}=await t.post("/api/auth/register",{email:e.email,password:e.password,confirmPassword:e.confirmPassword});return a}catch(e){var r;return s(null==(r=e.response)?void 0:r.data)}}),o=(0,r.zD)("auth/fetchAuthMe",async(e,a)=>{let{rejectWithValue:s}=a;try{let{data:e}=await t.get("/auth/me");return e}catch(e){return s(e.response.data)}}),n=(0,r.Z0)({name:"auth",initialState:{data:null,status:"idle",error:null},reducers:{logout:e=>{e.data=null,e.status="idle",e.error=null},clearError:e=>{e.error=null}},extraReducers:e=>{e.addMatcher(e=>e.type.endsWith("/pending"),e=>{e.status="loading",e.error=null}).addMatcher(e=>e.type.endsWith("/fulfilled"),(e,a)=>{e.status="succeeded",e.data=a.payload}).addMatcher(e=>e.type.endsWith("/rejected"),(e,a)=>{var s;e.status="failed",e.error=(null==(s=a.payload)?void 0:s.message)||"Произошла ошибка"})}}),d=e=>!!e.auth.data,c=e=>e.auth.error,{logout:u,clearError:m}=n.actions,h=n.reducer},6429:(e,a,s)=>{Promise.resolve().then(s.bind(s,2141))}},e=>{var a=a=>e(e.s=a);e.O(0,[296,464,874,635,558,441,684,358],()=>a(6429)),_N_E=e.O()}]);