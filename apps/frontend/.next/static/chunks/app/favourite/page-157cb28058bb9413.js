(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{1462:()=>{},1955:(e,t,a)=>{"use strict";a.d(t,{MI:()=>o,ob:()=>u,Us:()=>d});var r=a(5155),i=a(2115),c=a(3464);function s(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)e[r]=a[r]}return e}var n=function e(t,a){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=s({},a,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var n in i)i[n]&&(c+="; "+n,!0!==i[n]&&(c+="="+i[n].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+c}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],r={},i=0;i<a.length;i++){var c=a[i].split("="),s=c.slice(1).join("=");try{var n=decodeURIComponent(c[0]);if(r[n]=t.read(s,n),e===n)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",s({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,s({},this.attributes,t))},withConverter:function(t){return e(s({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});let o=(0,i.createContext)(null),l="https://673876654eb22e24fca800c5.mockapi.io",u=e=>{let{children:t}=e,[a,s]=(0,i.useState)([]),[u,d]=(0,i.useState)([]),[m,f]=(0,i.useState)(!0),[p,v]=(0,i.useState)(null),[h,x]=(0,i.useState)(""),[g,b]=(0,i.useState)([]),j=(null==u?void 0:u.map(e=>({...e,price:Number(e.price)})))||[];(0,i.useEffect)(()=>{let e=n.get("favorites");if(e)try{b(JSON.parse(e))}catch(e){console.error("Ошибка при загрузке избранного:",e)}},[]),(0,i.useEffect)(()=>{g.length>0?n.set("favorites",JSON.stringify(g),{expires:30}):n.remove("favorites")},[g]);let y=(0,i.useCallback)(e=>{b(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),C=(0,i.useCallback)(e=>{b(t=>t.filter(t=>t.id!==e))},[]),N=(0,i.useCallback)(e=>g.some(t=>t.id===e),[g]),k=(0,i.useCallback)(async()=>{f(!0),v(null);try{let[e,t]=await Promise.allSettled([c.A.get("".concat(l,"/items")),c.A.get("".concat(l,"/cart"))]);"fulfilled"===e.status&&s(e.value.data),"fulfilled"===t.status&&d(t.value.data)}catch(e){v("Ошибка при загрузке данных!")}finally{f(!1)}},[]);(0,i.useEffect)(()=>{k()},[k]);let w=async e=>{try{let{data:t}=await c.A.post("".concat(l,"/items"),e);s(e=>[...e,t])}catch(e){console.error("Ошибка при добавлении товара:",e)}},U=async(e,t)=>{try{let{data:a}=await c.A.put("".concat(l,"/items/").concat(e),t);s(t=>t.map(t=>t.id===e?{...t,...a}:t))}catch(e){v("Ошибка при обновлении товара.")}},A=async e=>{try{await c.A.delete("".concat(l,"/items/").concat(e)),s(t=>t.filter(t=>t.id!==e))}catch(e){v("Ошибка при удалении товара.")}},I=(0,i.useCallback)(async e=>{try{let t=u.find(t=>t.title===e.title);if(t){let e={...t,quantity:t.quantity+1};await c.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(t.id),e),d(a=>a.map(a=>a.id===t.id?e:a))}else{let t={...e,quantity:1},{data:a}=await c.A.post("https://673876654eb22e24fca800c5.mockapi.io/cart",t);d(e=>[...e,a])}}catch(e){console.error("Ошибка при добавлении товара в корзину:",e)}},[u]),S=async e=>{try{let t=u.find(t=>t.id===e);if(!t)return;if(t.quantity>1){let a={...t,quantity:t.quantity-1};await c.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e),a),d(t=>t.map(t=>t.id===e?a:t))}else await c.A.delete("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e)),d(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Ошибка при обновлении количества товара:",e)}};return(0,r.jsxs)(o.Provider,{value:{items:a,cartItems:u,processedItems:j,addProduct:w,updateProduct:U,deleteProduct:A,onAddToCart:I,onRemoveItem:S,isItemInCart:e=>u.some(t=>t.title===e),activeCategory:h,setActiveCategory:x,loading:m,error:p,favorites:g,addToFavorites:y,removeFromFavorites:C,isItemInFavorites:N},children:[m?(0,r.jsx)("span",{className:"loader"}):t,p&&(0,r.jsx)("p",{style:{color:"red"},children:p})]})},d=()=>{let e=(0,i.useContext)(o);if(!e)throw Error("useContext must be inside a Provider with a value");return e}},4007:(e,t,a)=>{"use strict";a.d(t,{ob:()=>r.ob,Us:()=>r.Us});var r=a(1955)},5161:(e,t,a)=>{Promise.resolve().then(a.bind(a,6098))},5826:(e,t,a)=>{"use strict";a.d(t,{j:()=>n});var r=a(5155);a(2115);var i=a(4007),c=a(6874),s=a.n(c);function n(e){let{id:t,imageUrl:a,category:c,title:n,price:o=0}=e,{onAddToCart:l,isItemInCart:u,addToFavorites:d,removeFromFavorites:m,isItemInFavorites:f}=(0,i.Us)(),p=u(n),v=f(t),h=()=>{l({id:t,imageUrl:a,category:c,title:n,price:o})},x=(Number(o)||0).toLocaleString("ru-RU");return(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)(s(),{href:"/tovar/".concat(encodeURIComponent(n)),children:(0,r.jsx)("button",{className:"img",children:(0,r.jsx)("img",{src:a,alt:"products"})})}),(0,r.jsx)("button",{onClick:()=>{v?m(t):d({id:t,imageUrl:a,category:c,title:n,price:o})},className:"favorite-button",children:v?(0,r.jsx)("img",{className:"img5",src:"/icons/onFavourite.svg",alt:"Remove from Favorites"}):(0,r.jsx)("img",{className:"img5",src:"/icons/favourite.svg",alt:"Add to Favorites"})}),(0,r.jsx)("p",{children:c}),(0,r.jsx)("a",{children:n}),(0,r.jsxs)("b",{children:[x," ₽."]}),(0,r.jsx)("button",{className:"add",children:p?(0,r.jsx)(s(),{href:"/cart",children:(0,r.jsx)("img",{className:"img2",src:"/pictures/inCart.svg",alt:"In Cart"})}):(0,r.jsx)("button",{onClick:()=>h(),children:(0,r.jsx)("img",{className:"img2",src:"/pictures/toCart.svg",alt:"Add to Cart"})})})]},t)}},6098:(e,t,a)=>{"use strict";a.d(t,{FavoritesPage:()=>o});var r=a(5155);a(2115);var i=a(6874),c=a.n(i),s=a(4007),n=a(5826);function o(){let{favorites:e,removeFromFavorites:t}=(0,s.Us)();return e?(0,r.jsxs)("div",{className:"container",children:[(0,r.jsx)("h1",{children:"Избранные товары"}),0===e.length?(0,r.jsxs)("div",{className:"empty-favorites",children:[(0,r.jsx)("p",{children:"В избранном пока нет товаров"}),(0,r.jsx)(c(),{href:"/catalog",children:(0,r.jsx)("button",{className:"btn-primary",children:"Перейти в каталог"})})]}):(0,r.jsx)("div",{className:"favorites-grid",children:e.map(e=>(0,r.jsx)("div",{className:"favorite-item",children:(0,r.jsx)(n.j,{id:e.id,imageUrl:e.imageUrl,category:e.category,title:e.title,price:e.price})},"fav-".concat(e.id)))})]}):(0,r.jsx)("div",{className:"container",children:"Loading..."})}a(1462)}},e=>{var t=t=>e(e.s=t);e.O(0,[183,464,874,441,684,358],()=>t(5161)),_N_E=e.O()}]);