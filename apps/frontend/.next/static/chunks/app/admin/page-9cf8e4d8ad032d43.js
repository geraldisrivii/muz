(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{1955:(e,t,a)=>{"use strict";a.d(t,{MI:()=>n,ob:()=>d,Us:()=>m});var r=a(5155),s=a(2115),c=a(3464);function i(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)e[r]=a[r]}return e}var l=function e(t,a){function r(e,r,s){if("undefined"!=typeof document){"number"==typeof(s=i({},a,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var l in s)s[l]&&(c+="; "+l,!0!==s[l]&&(c+="="+s[l].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+c}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],r={},s=0;s<a.length;s++){var c=a[s].split("="),i=c.slice(1).join("=");try{var l=decodeURIComponent(c[0]);if(r[l]=t.read(i,l),e===l)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",i({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,i({},this.attributes,t))},withConverter:function(t){return e(i({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});let n=(0,s.createContext)(null),o="https://673876654eb22e24fca800c5.mockapi.io",d=e=>{let{children:t}=e,[a,i]=(0,s.useState)([]),[d,m]=(0,s.useState)([]),[u,h]=(0,s.useState)(!0),[p,f]=(0,s.useState)(null),[x,j]=(0,s.useState)(""),[g,y]=(0,s.useState)([]),b=(null==d?void 0:d.map(e=>({...e,price:Number(e.price)})))||[];(0,s.useEffect)(()=>{let e=l.get("favorites");if(e)try{y(JSON.parse(e))}catch(e){console.error("Ошибка при загрузке избранного:",e)}},[]),(0,s.useEffect)(()=>{g.length>0?l.set("favorites",JSON.stringify(g),{expires:30}):l.remove("favorites")},[g]);let v=(0,s.useCallback)(e=>{y(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),N=(0,s.useCallback)(e=>{y(t=>t.filter(t=>t.id!==e))},[]),k=(0,s.useCallback)(e=>g.some(t=>t.id===e),[g]),C=(0,s.useCallback)(async()=>{h(!0),f(null);try{let[e,t]=await Promise.allSettled([c.A.get("".concat(o,"/items")),c.A.get("".concat(o,"/cart"))]);"fulfilled"===e.status&&i(e.value.data),"fulfilled"===t.status&&m(t.value.data)}catch(e){f("Ошибка при загрузке данных!")}finally{h(!1)}},[]);(0,s.useEffect)(()=>{C()},[C]);let w=async e=>{try{let{data:t}=await c.A.post("".concat(o,"/items"),e);i(e=>[...e,t])}catch(e){console.error("Ошибка при добавлении товара:",e)}},S=async(e,t)=>{try{let{data:a}=await c.A.put("".concat(o,"/items/").concat(e),t);i(t=>t.map(t=>t.id===e?{...t,...a}:t))}catch(e){f("Ошибка при обновлении товара.")}},D=async e=>{try{await c.A.delete("".concat(o,"/items/").concat(e)),i(t=>t.filter(t=>t.id!==e))}catch(e){f("Ошибка при удалении товара.")}},U=(0,s.useCallback)(async e=>{try{let t=d.find(t=>t.title===e.title);if(t){let e={...t,quantity:t.quantity+1};await c.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(t.id),e),m(a=>a.map(a=>a.id===t.id?e:a))}else{let t={...e,quantity:1},{data:a}=await c.A.post("https://673876654eb22e24fca800c5.mockapi.io/cart",t);m(e=>[...e,a])}}catch(e){console.error("Ошибка при добавлении товара в корзину:",e)}},[d]),I=async e=>{try{let t=d.find(t=>t.id===e);if(!t)return;if(t.quantity>1){let a={...t,quantity:t.quantity-1};await c.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e),a),m(t=>t.map(t=>t.id===e?a:t))}else await c.A.delete("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e)),m(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Ошибка при обновлении количества товара:",e)}};return(0,r.jsxs)(n.Provider,{value:{items:a,cartItems:d,processedItems:b,addProduct:w,updateProduct:S,deleteProduct:D,onAddToCart:U,onRemoveItem:I,isItemInCart:e=>d.some(t=>t.title===e),activeCategory:x,setActiveCategory:j,loading:u,error:p,favorites:g,addToFavorites:v,removeFromFavorites:N,isItemInFavorites:k},children:[u?(0,r.jsx)("span",{className:"loader"}):t,p&&(0,r.jsx)("p",{style:{color:"red"},children:p})]})},m=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useContext must be inside a Provider with a value");return e}},2713:(e,t,a)=>{"use strict";a.d(t,{default:()=>l});var r=a(5155),s=a(2115);a(4629);var c=a(1955),i=a(2177);let l=()=>{let{items:e,addProduct:t,updateProduct:a,deleteProduct:l}=(0,c.Us)(),[n,o]=(0,s.useState)(""),[d,m]=(0,s.useState)(""),{register:u,handleSubmit:h,formState:{errors:p},reset:f}=(0,i.mN)({defaultValues:{category:"",title:"",price:0},mode:"onChange"}),{register:x,handleSubmit:j,formState:{errors:g},reset:y}=(0,i.mN)({defaultValues:{id:"",category:"",title:"",price:0},mode:"onChange"}),[b,v]=(0,s.useState)(""),[N,k]=(0,s.useState)(""),C=async e=>{try{let a={...e,id:Date.now(),imageUrl:n};await t(a),f(),o("")}catch(e){console.error(e)}},w=async e=>{if(!e.id)return void k("Введите ID продукта для обновления.");try{let t={title:e.title,category:e.category,price:e.price,imageUrl:d||e.imageUrl};await a(e.id,t),y(),m("")}catch(e){console.error(e)}},S=async()=>{if(!b)return void k("Введите ID продукта для удаления.");try{await l(b),k("")}catch(e){k("Ошибка при удалении продукта. Проверьте ID.")}};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("section",{className:"admin",children:(0,r.jsxs)("div",{className:"container",children:[(0,r.jsx)("h1",{className:"prei",children:"Админ-панель"}),(0,r.jsxs)("div",{className:"crud-section",children:[(0,r.jsx)("h2",{children:"Добавить продукт"}),(0,r.jsxs)("form",{onSubmit:h(C),children:[(0,r.jsx)("input",{type:"text",placeholder:"Название",...u("title",{required:"Введите название продукта."}),className:"form-control-item"}),p.title&&(0,r.jsx)("p",{className:"check",children:p.title.message}),(0,r.jsx)("input",{type:"text",placeholder:"Категория",...u("category",{required:"Введите категорию продукта."}),className:"form-control-item"}),p.category&&(0,r.jsx)("p",{className:"check",children:p.category.message}),(0,r.jsx)("input",{type:"number",placeholder:"Цена",...u("price",{required:"Введите цену продукта.",min:{value:1,message:"Цена должна быть больше 0."}}),className:"form-control-item"}),p.price&&(0,r.jsx)("p",{className:"check",children:p.price.message}),(0,r.jsx)("input",{type:"file",onChange:e=>{let t=e.target.files[0];if(t){if(t.size>5242880)return void alert("Изображение слишком большое, выберите файл меньше 5 МБ");let e=new FileReader;e.onloadend=()=>{o(e.result)},e.readAsDataURL(t)}},className:"form-control-item"}),n&&(0,r.jsx)("img",{src:n,alt:"Предпросмотр",width:"100"}),p.image&&(0,r.jsx)("p",{className:"check",children:p.image.message}),(0,r.jsx)("button",{type:"submit",className:"CRUD-btn",children:"Добавить продукт"}),p&&Object.keys(p).length>0&&(0,r.jsx)("p",{className:"check",children:"Пожалуйста, исправьте ошибки в форме."})]})]}),(0,r.jsxs)("div",{className:"crud-section",children:[(0,r.jsx)("h2",{children:"Обновить продукт"}),(0,r.jsxs)("form",{onSubmit:j(w),children:[(0,r.jsx)("input",{type:"text",placeholder:"ID продукта",...x("id",{required:"Введите ID продукта для обновления."}),className:"form-control-item"}),g.id&&(0,r.jsx)("p",{className:"check",children:g.id.message}),(0,r.jsx)("input",{type:"text",placeholder:"Новое название",...x("title",{required:"Введите новое название."}),className:"form-control-item"}),g.title&&(0,r.jsx)("p",{className:"check",children:g.title.message}),(0,r.jsx)("input",{type:"text",placeholder:"Категория",...x("category"),className:"form-control-item"}),(0,r.jsx)("input",{type:"number",placeholder:"Новая цена",...x("price",{min:{value:1,message:"Цена должна быть больше 0."}}),className:"form-control-item"}),g.price&&(0,r.jsx)("p",{className:"check",children:g.price.message}),(0,r.jsx)("input",{type:"file",onChange:e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onloadend=()=>{m(e.result)},e.readAsDataURL(t)}},className:"form-control-item"}),d&&(0,r.jsx)("img",{src:d,alt:"Предпросмотр",width:"100"}),g.image&&(0,r.jsx)("p",{className:"check",children:g.image.message}),(0,r.jsx)("button",{type:"submit",className:"CRUD-btn",children:"Обновить продукт"})]})]}),(0,r.jsxs)("div",{className:"crud-section",children:[(0,r.jsx)("h2",{children:"Удалить продукт"}),(0,r.jsx)("input",{type:"number",placeholder:"ID продукта для удаления",value:b,onChange:e=>v(e.target.value),className:"form-control-item"}),N&&(0,r.jsx)("p",{className:"check",children:N}),(0,r.jsx)("button",{className:"CRUD-btn",onClick:S,children:"Удалить продукт"})]}),(0,r.jsxs)("div",{className:"crud-section",children:[(0,r.jsx)("h2",{children:"Список товаров"}),e.length>0?(0,r.jsxs)("table",{className:"product-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"shapka",children:[(0,r.jsx)("th",{children:"ID"}),(0,r.jsx)("th",{children:"Название"}),(0,r.jsx)("th",{children:"Категория"}),(0,r.jsx)("th",{children:"Цена"}),(0,r.jsx)("th",{children:"Изображение"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.id}),(0,r.jsx)("td",{children:e.title}),(0,r.jsx)("td",{children:e.category}),(0,r.jsxs)("td",{children:[e.price," руб."]}),(0,r.jsx)("td",{children:(0,r.jsx)("img",{src:e.imageUrl,alt:e.title,width:"50",height:"50"})})]},e.id))})]}):(0,r.jsx)("p",{children:"Список товаров пуст"})]})]})})})}},3133:(e,t,a)=>{Promise.resolve().then(a.bind(a,2713))},4629:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[132,464,558,441,684,358],()=>t(3133)),_N_E=e.O()}]);