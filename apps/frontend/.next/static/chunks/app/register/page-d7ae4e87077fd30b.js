(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{2777:()=>{},5695:(e,s,a)=>{"use strict";var t=a(8999);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})},6421:(e,s,a)=>{"use strict";a.d(s,{li:()=>h,tw:()=>i,Rd:()=>o,_D:()=>l,ri:()=>u,ZB:()=>d,BN:()=>n});var t=a(1990);let r=a(3464).A.create({baseURL:"http://localhost:3002"});r.interceptors.request.use(e=>(e.headers.Authorization=window.localStorage.getItem("token"),e));let i=(0,t.zD)("auth/fetchAuth",async(e,s)=>{let{rejectWithValue:a}=s;try{let s=await fetch("http://localhost:3002/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})});if(!s.ok){let e=await s.json();return a(e)}return await s.json()}catch(e){return a(e.message)}}),l=(0,t.zD)("auth/fetchRegister",async(e,s)=>{let{rejectWithValue:a}=s;try{let{data:s}=await r.post("/api/auth/register",{email:e.email,password:e.password,confirmPassword:e.confirmPassword});return s}catch(e){var t;return a(null==(t=e.response)?void 0:t.data)}}),o=(0,t.zD)("auth/fetchAuthMe",async(e,s)=>{let{rejectWithValue:a}=s;try{let{data:e}=await r.get("/auth/me");return e}catch(e){return a(e.response.data)}}),c=(0,t.Z0)({name:"auth",initialState:{data:null,status:"idle",error:null},reducers:{logout:e=>{e.data=null,e.status="idle",e.error=null},clearError:e=>{e.error=null}},extraReducers:e=>{e.addMatcher(e=>e.type.endsWith("/pending"),e=>{e.status="loading",e.error=null}).addMatcher(e=>e.type.endsWith("/fulfilled"),(e,s)=>{e.status="succeeded",e.data=s.payload}).addMatcher(e=>e.type.endsWith("/rejected"),(e,s)=>{var a;e.status="failed",e.error=(null==(a=s.payload)?void 0:a.message)||"Произошла ошибка"})}}),n=e=>!!e.auth.data,d=e=>e.auth.error,{logout:u,clearError:m}=c.actions,h=c.reducer},8357:(e,s,a)=>{"use strict";a.d(s,{default:()=>u});var t=a(5155),r=a(2115),i=a(5695),l=a(6874),o=a.n(l),c=a(2177),n=a(4540),d=a(6421);a(2777);let u=()=>{let e=(0,i.useRouter)(),s=(0,n.wA)();(0,n.d4)(d.BN);let a=(0,n.d4)(d.ZB),[l,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)("register"),[p,f]=(0,r.useState)(""),{register:g,handleSubmit:j,watch:x,formState:{errors:N,isValid:v}}=(0,c.mN)({defaultValues:{fullName:"",email:"",password:"",confirmPassword:"",verificationCode:""},mode:"onChange"}),y=async e=>{let a=await s((0,d._D)(e));d._D.fulfilled.match(a)&&(f(e.email),h("verify"))},w=async s=>{try{let a=await fetch("http://localhost:3002/api/auth/email-verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:s.verificationCode,email:p})});await a.json(),a.ok?e.push("/login"):e.push("/")}catch(e){alert(e.message)}},b=x("password");return"verify"===m?(0,t.jsx)("section",{className:"Login",children:(0,t.jsxs)("div",{className:"preview",children:[(0,t.jsx)("h3",{className:"text-center",children:"Подтверждение Email"}),(0,t.jsxs)("p",{className:"text-center",children:["Код отправлен на ",p]}),(0,t.jsx)("div",{className:"registration-cssave",children:(0,t.jsxs)("form",{onSubmit:j(w),children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("input",{className:"form-control-item",type:"text",placeholder:"Введите код из письма",...g("verificationCode",{required:"Введите код подтверждения"})}),l&&N.verificationCode&&(0,t.jsx)("p",{className:"check",children:N.verificationCode.message})]}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsx)("button",{className:"btn btn-primary btn-block create-account",type:"submit",children:"ПОДТВЕРДИТЬ"})}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsx)("button",{type:"button",className:"log-in",onClick:()=>h("register"),children:"Назад к регистрации"})})]})})]})}):(0,t.jsx)("section",{className:"Login",children:(0,t.jsxs)("div",{className:"preview",children:[(0,t.jsx)("h3",{className:"text-center",children:"Регистрация"}),a&&(0,t.jsx)("p",{className:"check",style:{color:"red",textAlign:"center"},children:a}),(0,t.jsx)("div",{className:"registration-cssave",children:(0,t.jsxs)("form",{onSubmit:j(y),children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("input",{className:"form-control-item",type:"email",placeholder:"Email",...g("email",{required:"Введите почту",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Введите корректный email"}}),onFocus:()=>u(!0)}),l&&N.email&&(0,t.jsx)("p",{className:"check",children:N.email.message})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("input",{className:"form-control-item",type:"password",placeholder:"Пароль",...g("password",{required:"Введите пароль",minLength:{value:6,message:"Минимум 6 символов"}}),onFocus:()=>u(!0)}),l&&N.password&&(0,t.jsx)("p",{className:"check",children:N.password.message})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("input",{className:"form-control-item",type:"password",placeholder:"Повторите пароль",...g("confirmPassword",{required:"Подтвердите пароль",validate:e=>e===b||"Пароли не совпадают"}),onFocus:()=>u(!0)}),l&&N.confirmPassword&&(0,t.jsx)("p",{className:"check",children:N.confirmPassword.message})]}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsx)("button",{className:"btn btn-primary btn-block create-account",type:"submit",disabled:!v,children:"СОЗДАТЬ"})}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsx)(o(),{href:"/login",children:(0,t.jsxs)("button",{className:"log-in",type:"button",children:["Есть аккаунт? ",(0,t.jsx)("a",{children:"Войти"})]})})})]})})]})})}},8485:(e,s,a)=>{Promise.resolve().then(a.bind(a,8357))}},e=>{var s=s=>e(e.s=s);e.O(0,[280,464,874,635,558,441,684,358],()=>s(8485)),_N_E=e.O()}]);