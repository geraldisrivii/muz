(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{809:(e,t,a)=>{Promise.resolve().then(a.bind(a,1500))},1500:(e,t,a)=>{"use strict";a.d(t,{default:()=>h});var s=a(5155);a(4199);var r=a(2115),i=a(1955),c=a(4540),n=a(6421),l=a(5695),o=a(6874),d=a.n(o);let u=e=>{let{}=e,{processedItems:t,onAddToCart:a,onRemoveItem:r}=(0,i.Us)(),o=(0,c.d4)(n.BN),u=(0,l.useRouter)();return(0,s.jsx)("div",{className:"container",children:(0,s.jsx)("div",{className:"cart",children:t.length>0?(0,s.jsxs)("div",{className:"cart-main",children:[(0,s.jsxs)("div",{className:"precart",children:[(0,s.jsx)("span",{children:"КОРЗИНА"}),(0,s.jsx)("a",{onClick:()=>r("all"),children:"Очистить всю корзину"})]}),(0,s.jsxs)("div",{className:"cart-content",children:[(0,s.jsx)("div",{className:"items",children:t.map(e=>(0,s.jsxs)("div",{className:"cartItem",children:[(0,s.jsx)(d(),{href:"/tovar/".concat(encodeURIComponent(e.title)),children:(0,s.jsx)("div",{className:"cartItemImg",children:(0,s.jsx)("img",{src:e.imageUrl,alt:e.title,width:50,height:50})})}),(0,s.jsxs)("div",{className:"main",children:[(0,s.jsxs)("div",{className:"descrip",children:[(0,s.jsx)("div",{className:"category",children:e.category}),(0,s.jsx)("div",{className:"name",children:e.title})]}),(0,s.jsxs)("div",{className:"number",children:[(0,s.jsx)("button",{className:"minus",onClick:()=>(e.quantity,r(e.id)),children:"-"}),(0,s.jsx)("span",{className:"counter",children:e.quantity||1}),(0,s.jsx)("button",{className:"plus",onClick:()=>a(e),children:"+"})]}),(0,s.jsxs)("div",{className:"price",children:[(e.price*(e.quantity||1)).toLocaleString("ru-RU")," руб."]}),(0,s.jsx)("button",{onClick:()=>r(e.id),className:"trashImg",children:(0,s.jsx)("img",{src:"/products/TrashCan.svg",alt:"Remove"})})]})]},e.id))}),(0,s.jsxs)("div",{className:"order-block",children:[(0,s.jsx)("div",{className:"total-menu",children:(0,s.jsxs)("div",{className:"main-total",children:[(0,s.jsx)("div",{className:"subtitle",children:(0,s.jsx)("span",{children:"ВАШ ЗАКАЗ"})}),(0,s.jsxs)("div",{className:"basket-row-total",children:[(0,s.jsxs)("a",{children:[t.reduce((e,t)=>e+(t.quantity||1),0)," товаров"]}),(0,s.jsxs)("a",{children:[t.reduce((e,t)=>e+t.price*(t.quantity||1),0).toLocaleString("ru-RU")," ","р."]})]}),(0,s.jsxs)("div",{className:"basket-row-final",children:[(0,s.jsx)("b",{children:"Итого"}),(0,s.jsxs)("b",{children:[t.reduce((e,t)=>e+t.price*(t.quantity||1),0).toLocaleString("ru-RU")," ","р."]})]}),(0,s.jsx)("button",{className:"buy",onClick:()=>{o?u.push("/checkout"):u.push("/login")},children:"Купить"})]})}),(0,s.jsx)("div",{className:"aftertitle",children:(0,s.jsx)("span",{children:"Только самовывоз!"})})]})]})]}):(0,s.jsxs)("div",{className:"cartEmpty",children:[(0,s.jsx)("div",{className:"precart2",children:(0,s.jsx)("span",{children:"КОРЗИНА"})}),(0,s.jsxs)("div",{className:"center",children:[(0,s.jsx)("h1",{children:"В корзине пока нет товаров"}),(0,s.jsx)("p",{children:"Добавляйте понравившиеся товары и наслаждайтесь покупками️"}),(0,s.jsx)(d(),{href:"/catalog",children:(0,s.jsx)("button",{className:"toCatalog",children:(0,s.jsx)("img",{src:"/pic/toCatalog.svg",alt:"To Catalog"})})})]})]})})})},h=()=>{let e=(0,r.useContext)(i.MI);return(0,r.useContext)(i.MI),console.log("data",e),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(u,{})})}},1955:(e,t,a)=>{"use strict";a.d(t,{MI:()=>l,ob:()=>d,Us:()=>u});var s=a(5155),r=a(2115),i=a(3464);function c(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)e[s]=a[s]}return e}var n=function e(t,a){function s(e,s,r){if("undefined"!=typeof document){"number"==typeof(r=c({},a,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var n in r)r[n]&&(i+="; "+n,!0!==r[n]&&(i+="="+r[n].split(";")[0]));return document.cookie=e+"="+t.write(s,e)+i}}return Object.create({set:s,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],s={},r=0;r<a.length;r++){var i=a[r].split("="),c=i.slice(1).join("=");try{var n=decodeURIComponent(i[0]);if(s[n]=t.read(c,n),e===n)break}catch(e){}}return e?s[e]:s}},remove:function(e,t){s(e,"",c({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,c({},this.attributes,t))},withConverter:function(t){return e(c({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});let l=(0,r.createContext)(null),o="https://673876654eb22e24fca800c5.mockapi.io",d=e=>{let{children:t}=e,[a,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null),[v,x]=(0,r.useState)(""),[j,y]=(0,r.useState)([]),g=(null==d?void 0:d.map(e=>({...e,price:Number(e.price)})))||[];(0,r.useEffect)(()=>{let e=n.get("favorites");if(e)try{y(JSON.parse(e))}catch(e){console.error("Ошибка при загрузке избранного:",e)}},[]),(0,r.useEffect)(()=>{j.length>0?n.set("favorites",JSON.stringify(j),{expires:30}):n.remove("favorites")},[j]);let b=(0,r.useCallback)(e=>{y(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),N=(0,r.useCallback)(e=>{y(t=>t.filter(t=>t.id!==e))},[]),w=(0,r.useCallback)(e=>j.some(t=>t.id===e),[j]),C=(0,r.useCallback)(async()=>{m(!0),f(null);try{let[e,t]=await Promise.allSettled([i.A.get("".concat(o,"/items")),i.A.get("".concat(o,"/cart"))]);"fulfilled"===e.status&&c(e.value.data),"fulfilled"===t.status&&u(t.value.data)}catch(e){f("Ошибка при загрузке данных!")}finally{m(!1)}},[]);(0,r.useEffect)(()=>{C()},[C]);let k=async e=>{try{let{data:t}=await i.A.post("".concat(o,"/items"),e);c(e=>[...e,t])}catch(e){console.error("Ошибка при добавлении товара:",e)}},R=async(e,t)=>{try{let{data:a}=await i.A.put("".concat(o,"/items/").concat(e),t);c(t=>t.map(t=>t.id===e?{...t,...a}:t))}catch(e){f("Ошибка при обновлении товара.")}},I=async e=>{try{await i.A.delete("".concat(o,"/items/").concat(e)),c(t=>t.filter(t=>t.id!==e))}catch(e){f("Ошибка при удалении товара.")}},S=(0,r.useCallback)(async e=>{try{let t=d.find(t=>t.title===e.title);if(t){let e={...t,quantity:t.quantity+1};await i.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(t.id),e),u(a=>a.map(a=>a.id===t.id?e:a))}else{let t={...e,quantity:1},{data:a}=await i.A.post("https://673876654eb22e24fca800c5.mockapi.io/cart",t);u(e=>[...e,a])}}catch(e){console.error("Ошибка при добавлении товара в корзину:",e)}},[d]),A=async e=>{try{let t=d.find(t=>t.id===e);if(!t)return;if(t.quantity>1){let a={...t,quantity:t.quantity-1};await i.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e),a),u(t=>t.map(t=>t.id===e?a:t))}else await i.A.delete("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e)),u(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Ошибка при обновлении количества товара:",e)}};return(0,s.jsxs)(l.Provider,{value:{items:a,cartItems:d,processedItems:g,addProduct:k,updateProduct:R,deleteProduct:I,onAddToCart:S,onRemoveItem:A,isItemInCart:e=>d.some(t=>t.title===e),activeCategory:v,setActiveCategory:x,loading:h,error:p,favorites:j,addToFavorites:b,removeFromFavorites:N,isItemInFavorites:w},children:[h?(0,s.jsx)("span",{className:"loader"}):t,p&&(0,s.jsx)("p",{style:{color:"red"},children:p})]})},u=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useContext must be inside a Provider with a value");return e}},4199:()=>{},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},6421:(e,t,a)=>{"use strict";a.d(t,{li:()=>m,tw:()=>i,Rd:()=>n,_D:()=>c,ri:()=>u,ZB:()=>d,BN:()=>o});var s=a(1990);let r=a(3464).A.create({baseURL:"http://localhost:3002"});r.interceptors.request.use(e=>(e.headers.Authorization=window.localStorage.getItem("token"),e));let i=(0,s.zD)("auth/fetchAuth",async(e,t)=>{let{rejectWithValue:a}=t;try{let t=await fetch("http://localhost:3002/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})});if(!t.ok){let e=await t.json();return a(e)}return await t.json()}catch(e){return a(e.message)}}),c=(0,s.zD)("auth/fetchRegister",async(e,t)=>{let{rejectWithValue:a}=t;try{let{data:t}=await r.post("/api/auth/register",{email:e.email,password:e.password,confirmPassword:e.confirmPassword});return t}catch(e){var s;return a(null==(s=e.response)?void 0:s.data)}}),n=(0,s.zD)("auth/fetchAuthMe",async(e,t)=>{let{rejectWithValue:a}=t;try{let{data:e}=await r.get("/auth/me");return e}catch(e){return a(e.response.data)}}),l=(0,s.Z0)({name:"auth",initialState:{data:null,status:"idle",error:null},reducers:{logout:e=>{e.data=null,e.status="idle",e.error=null},clearError:e=>{e.error=null}},extraReducers:e=>{e.addMatcher(e=>e.type.endsWith("/pending"),e=>{e.status="loading",e.error=null}).addMatcher(e=>e.type.endsWith("/fulfilled"),(e,t)=>{e.status="succeeded",e.data=t.payload}).addMatcher(e=>e.type.endsWith("/rejected"),(e,t)=>{var a;e.status="failed",e.error=(null==(a=t.payload)?void 0:a.message)||"Произошла ошибка"})}}),o=e=>!!e.auth.data,d=e=>e.auth.error,{logout:u,clearError:h}=l.actions,m=l.reducer}},e=>{var t=t=>e(e.s=t);e.O(0,[150,464,874,635,441,684,358],()=>t(809)),_N_E=e.O()}]);