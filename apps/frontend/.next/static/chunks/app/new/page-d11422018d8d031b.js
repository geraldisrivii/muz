(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[359],{103:()=>{},571:(e,t,a)=>{"use strict";a.r(t),a.d(t,{CatalogItems:()=>i});var r=a(5155);a(2115),a(103);var c=a(5826),s=a(4007);let i=()=>{let{items:e}=(0,s.Us)(),{cartItems:t,onAddToCart:a}=(0,s.Us)(),{activeCategory:i,setActiveCategory:n}=(0,s.Us)(),o=i?e.filter(e=>e.category===i):e;return(0,r.jsx)("section",{className:"Products",children:(0,r.jsxs)("div",{className:"container",children:[(0,r.jsx)("span",{children:"Популярные товары"}),(0,r.jsx)("div",{className:"tovary",children:o.map(e=>(0,r.jsx)(c.j,{...e},e.id))})]})})}},1955:(e,t,a)=>{"use strict";a.d(t,{MI:()=>o,ob:()=>u,Us:()=>d});var r=a(5155),c=a(2115),s=a(3464);function i(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)e[r]=a[r]}return e}var n=function e(t,a){function r(e,r,c){if("undefined"!=typeof document){"number"==typeof(c=i({},a,c)).expires&&(c.expires=new Date(Date.now()+864e5*c.expires)),c.expires&&(c.expires=c.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var n in c)c[n]&&(s+="; "+n,!0!==c[n]&&(s+="="+c[n].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+s}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],r={},c=0;c<a.length;c++){var s=a[c].split("="),i=s.slice(1).join("=");try{var n=decodeURIComponent(s[0]);if(r[n]=t.read(i,n),e===n)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",i({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,i({},this.attributes,t))},withConverter:function(t){return e(i({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});let o=(0,c.createContext)(null),l="https://673876654eb22e24fca800c5.mockapi.io",u=e=>{let{children:t}=e,[a,i]=(0,c.useState)([]),[u,d]=(0,c.useState)([]),[m,f]=(0,c.useState)(!0),[p,v]=(0,c.useState)(null),[h,b]=(0,c.useState)(""),[x,g]=(0,c.useState)([]),C=(null==u?void 0:u.map(e=>({...e,price:Number(e.price)})))||[];(0,c.useEffect)(()=>{let e=n.get("favorites");if(e)try{g(JSON.parse(e))}catch(e){console.error("Ошибка при загрузке избранного:",e)}},[]),(0,c.useEffect)(()=>{x.length>0?n.set("favorites",JSON.stringify(x),{expires:30}):n.remove("favorites")},[x]);let j=(0,c.useCallback)(e=>{g(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),y=(0,c.useCallback)(e=>{g(t=>t.filter(t=>t.id!==e))},[]),k=(0,c.useCallback)(e=>x.some(t=>t.id===e),[x]),N=(0,c.useCallback)(async()=>{f(!0),v(null);try{let[e,t]=await Promise.allSettled([s.A.get("".concat(l,"/items")),s.A.get("".concat(l,"/cart"))]);"fulfilled"===e.status&&i(e.value.data),"fulfilled"===t.status&&d(t.value.data)}catch(e){v("Ошибка при загрузке данных!")}finally{f(!1)}},[]);(0,c.useEffect)(()=>{N()},[N]);let w=async e=>{try{let{data:t}=await s.A.post("".concat(l,"/items"),e);i(e=>[...e,t])}catch(e){console.error("Ошибка при добавлении товара:",e)}},U=async(e,t)=>{try{let{data:a}=await s.A.put("".concat(l,"/items/").concat(e),t);i(t=>t.map(t=>t.id===e?{...t,...a}:t))}catch(e){v("Ошибка при обновлении товара.")}},A=async e=>{try{await s.A.delete("".concat(l,"/items/").concat(e)),i(t=>t.filter(t=>t.id!==e))}catch(e){v("Ошибка при удалении товара.")}},I=(0,c.useCallback)(async e=>{try{let t=u.find(t=>t.title===e.title);if(t){let e={...t,quantity:t.quantity+1};await s.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(t.id),e),d(a=>a.map(a=>a.id===t.id?e:a))}else{let t={...e,quantity:1},{data:a}=await s.A.post("https://673876654eb22e24fca800c5.mockapi.io/cart",t);d(e=>[...e,a])}}catch(e){console.error("Ошибка при добавлении товара в корзину:",e)}},[u]),S=async e=>{try{let t=u.find(t=>t.id===e);if(!t)return;if(t.quantity>1){let a={...t,quantity:t.quantity-1};await s.A.put("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e),a),d(t=>t.map(t=>t.id===e?a:t))}else await s.A.delete("https://673876654eb22e24fca800c5.mockapi.io/cart/".concat(e)),d(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Ошибка при обновлении количества товара:",e)}};return(0,r.jsxs)(o.Provider,{value:{items:a,cartItems:u,processedItems:C,addProduct:w,updateProduct:U,deleteProduct:A,onAddToCart:I,onRemoveItem:S,isItemInCart:e=>u.some(t=>t.title===e),activeCategory:h,setActiveCategory:b,loading:m,error:p,favorites:x,addToFavorites:j,removeFromFavorites:y,isItemInFavorites:k},children:[m?(0,r.jsx)("span",{className:"loader"}):t,p&&(0,r.jsx)("p",{style:{color:"red"},children:p})]})},d=()=>{let e=(0,c.useContext)(o);if(!e)throw Error("useContext must be inside a Provider with a value");return e}},3872:(e,t,a)=>{Promise.resolve().then(a.bind(a,571))},4007:(e,t,a)=>{"use strict";a.d(t,{ob:()=>r.ob,Us:()=>r.Us});var r=a(1955)},5826:(e,t,a)=>{"use strict";a.d(t,{j:()=>n});var r=a(5155);a(2115);var c=a(4007),s=a(6874),i=a.n(s);function n(e){let{id:t,imageUrl:a,category:s,title:n,price:o=0}=e,{onAddToCart:l,isItemInCart:u,addToFavorites:d,removeFromFavorites:m,isItemInFavorites:f}=(0,c.Us)(),p=u(n),v=f(t),h=()=>{l({id:t,imageUrl:a,category:s,title:n,price:o})},b=(Number(o)||0).toLocaleString("ru-RU");return(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)(i(),{href:"/tovar/".concat(encodeURIComponent(n)),children:(0,r.jsx)("button",{className:"img",children:(0,r.jsx)("img",{src:a,alt:"products"})})}),(0,r.jsx)("button",{onClick:()=>{v?m(t):d({id:t,imageUrl:a,category:s,title:n,price:o})},className:"favorite-button",children:v?(0,r.jsx)("img",{className:"img5",src:"/icons/onFavourite.svg",alt:"Remove from Favorites"}):(0,r.jsx)("img",{className:"img5",src:"/icons/favourite.svg",alt:"Add to Favorites"})}),(0,r.jsx)("p",{children:s}),(0,r.jsx)("a",{children:n}),(0,r.jsxs)("b",{children:[b," ₽."]}),(0,r.jsx)("button",{className:"add",children:p?(0,r.jsx)(i(),{href:"/cart",children:(0,r.jsx)("img",{className:"img2",src:"/pictures/inCart.svg",alt:"In Cart"})}):(0,r.jsx)("button",{onClick:()=>h(),children:(0,r.jsx)("img",{className:"img2",src:"/pictures/toCart.svg",alt:"Add to Cart"})})})]},t)}}},e=>{var t=t=>e(e.s=t);e.O(0,[710,464,874,441,684,358],()=>t(3872)),_N_E=e.O()}]);